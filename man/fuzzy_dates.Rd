% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/match_utils.R
\name{fuzzy_dates}
\alias{fuzzy_dates}
\title{Fuzzy-match fish tickets to length (or sample) records by vessel and delivery date}
\usage{
fuzzy_dates(length_data, Fish_ticket, ndays = 7)
}
\arguments{
\item{length_data}{A data frame containing, at minimum, columns
\code{DELIVERING_VESSEL} and \code{DELIVERY_DATE}. Typically a length or
biological sample dataset.}

\item{Fish_ticket}{A data frame containing, at minimum, columns
\code{DELIVERING_VESSEL} and \code{DELIVERY_DATE}. Additional columns are
retained and merged onto matched \code{length_data} rows.}

\item{ndays}{Integer (or numeric) maximum allowed absolute difference between
\code{DELIVERY_DATE} values in days. Matches with \code{date_diff > ndays} are
dropped. Default is \code{7}.}
}
\value{
A data frame with the same rows as \code{length_data}, augmented with
fish ticket fields for matched records. An \code{ID} column (internal ticket row
identifier) and \code{date_diff} (absolute difference in days) are included for
matched rows; unmatched rows have \code{NA} in the appended fields.
}
\description{
Performs a "fuzzy" join between a length/sample dataset and a fish ticket dataset
using \code{DELIVERING_VESSEL} as the primary key and allowing delivery dates to
differ by up to \code{ndays}. For each \code{(DELIVERING_VESSEL, DELIVERY_DATE)}
combination in the length data, the function selects the fish ticket record with
the smallest absolute date difference (ties resolved by the first minimum found).
}
\details{
This helper is intended for workflows where the same landing/sample can appear
in multiple systems with small discrepancies in recorded delivery dates (e.g.,
landing vs ticket posting dates).

The matching procedure:
\enumerate{
\item Subset the two inputs to \code{DELIVERING_VESSEL} and \code{DELIVERY_DATE},
adding a row identifier \code{ID} to the fish ticket table.
\item Join all combinations by \code{DELIVERING_VESSEL}.
\item Compute \code{date_diff = abs(DELIVERY_DATE - DELIVERY_DATE2)}.
\item For each \code{(DELIVERING_VESSEL, DELIVERY_DATE)} in \code{length_data},
keep the fish ticket row with minimum \code{date_diff}.
\item Filter to \code{date_diff <= ndays}.
\item Merge matched ticket attributes back onto \code{length_data}.
}
}
\section{Assumptions and caveats}{

\itemize{
\item \code{DELIVERY_DATE} fields must be coercible to \code{Date}.
\item This function chooses at most one ticket per \code{(vessel, date)} from the
length data; if multiple tickets are equally close, the first minimum is used.
\item The function relies on \pkg{dplyr} joins and grouping semantics; ensure the
necessary packages are available/attached in your workflow.
}
}

\examples{
\dontrun{
# Match tickets within +/- 3 days
out <- fuzzy_dates(length_data = len_df, Fish_ticket = ticket_df, ndays = 3)
}

}
