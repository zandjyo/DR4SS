% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Get_lengthweight.r
\name{get_lengthweight}
\alias{get_lengthweight}
\title{Estimate annual length–weight parameters from survey data}
\usage{
get_lengthweight(
  con_akfin,
  con_afsc = NULL,
  species = 202,
  area = "BS",
  K = 7,
  Alpha_series = 2,
  Beta_series = 3,
  min_year = 1977
)
}
\arguments{
\item{con_akfin}{A DBI connection used to run \code{dom_age_wt.sql}.}

\item{con_afsc}{Optional DBI connection used to run \code{for_age_wt.sql}.
If \code{NULL}, foreign data are not included.}

\item{species}{Numeric species code (single value).}

\item{area}{Character area identifier: one of \code{"BS"}, \code{"AI"}, \code{"GOA"}.}

\item{K}{Integer basis dimension for cyclic GAM smooths on week-of-year.}

\item{Alpha_series}{Integer series ID for alpha deviations in the output.}

\item{Beta_series}{Integer series ID for beta deviations in the output.}

\item{min_year}{Integer; years prior to this are excluded when estimating the
overall (baseline) length–weight relationship.}
}
\value{
A data.table with columns \code{YEAR}, \code{SERIES}, and \code{VALUE}.
}
\description{
Pulls domestic and (optionally) foreign survey age–length–weight records,
applies standard outlier filtering, fits an overall log–log length–weight
relationship, and then estimates annual deviations in the intercept (alpha)
and slope (beta) using a generalized additive model (GAM).
}
\details{
The resulting annual deviations are returned as environmental time series
suitable for use in Stock Synthesis:
\itemize{
\item Alpha-series: \code{exp(alpha_year) - exp(alpha_overall)}
\item Beta-series:  \code{beta_year - beta_overall}
}

SQL is loaded from packaged templates:
\itemize{
\item \code{dom_age_wt.sql} (domestic survey data)
\item \code{for_age_wt.sql} (foreign survey data; optional)
}

Both SQL templates must include placeholder flags:
\itemize{
\item \code{-- insert species}
\item \code{-- insert location}
}
}
\section{Statistical rationale}{

Annual length–weight parameters are extracted by predicting model-based
weights over a \strong{fixed, common length grid} shared across all years.
This grid is internally defined using the 5th–95th percentiles of observed
lengths, ensuring that year-to-year differences in estimated alpha and beta
reflect changes in the length–weight relationship itself, rather than
differences in the observed size composition among years. This approach
produces more stable and comparable time series for use as environmental
covariates in Stock Synthesis.
}

