% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fishery_ewaa_catch_weighted.R,
%   R/ishery_ewaa_catch_weighted.R
\name{fishery_ewaa_catch_weighted}
\alias{fishery_ewaa_catch_weighted}
\title{Catch-weighted empirical weight-at-age (EWAA) for fishery data}
\usage{
fishery_ewaa_catch_weighted(
  con_akfin,
  species = 202,
  species_group = "PCOD",
  region,
  len_bins,
  maxage = 12,
  gear_mode = c("combined", "by_gear"),
  sex_mode = c("combined", "split"),
  trim_outliers = TRUE,
  trim_q = c(0.01, 0.99),
  min_strata_n = 1,
  year_min = 2007,
  catch_subarea,
  catch_year_max,
  standard_quarter = TRUE,
  target_qtr = 4L
)

fishery_ewaa_catch_weighted(
  con_akfin,
  species = 202,
  species_group = "PCOD",
  region,
  len_bins,
  maxage = 12,
  gear_mode = c("combined", "by_gear"),
  sex_mode = c("combined", "split"),
  trim_outliers = TRUE,
  trim_q = c(0.01, 0.99),
  min_strata_n = 1,
  year_min = 2007,
  catch_subarea,
  catch_year_max,
  standard_quarter = TRUE,
  target_qtr = 4L
)
}
\arguments{
\item{con_akfin}{A DBI connection to AKFIN (or equivalent schema containing the blend catch
and fishery biological tables queried by the helper functions).}

\item{species}{Numeric fishery species code used by the fishery biology SQL/data pull.}

\item{species_group}{Character species code used by the blend catch query
(e.g., "PCOD" if blend catch uses a group label rather than numeric code).}

\item{region}{Region selector passed to \code{get_fishery_age_wt_data()} (e.g., "BS", "GOA", etc.).}

\item{len_bins}{Numeric vector of length bin edges used to build the empirical length-at-age.}

\item{maxage}{Plus-group age; ages > maxage are pooled to maxage.}

\item{gear_mode}{Either "combined" or "by_gear".}

\item{sex_mode}{Either "combined" or "split".}

\item{trim_outliers}{Logical; if TRUE, trim extreme weight observations before fitting the LW key.}

\item{trim_q}{Numeric length-2 vector of quantiles used when trimming weights (e.g., c(0.01, 0.99)).}

\item{min_strata_n}{Minimum sample size required to retain a model stratum when fitting (e.g., by gear/area/quarter).}

\item{year_min}{Minimum fishery YEAR to include in biology pulls.}

\item{catch_subarea}{Subarea code(s) passed to the blend catch query (character, e.g., "BS").}

\item{catch_year_max}{Maximum year (inclusive) to include in blend catch.}

\item{standard_quarter}{Logical. If TRUE, translate lengths to \code{target_qtr} using a delta-length
growth model before applying the LW key. This yields a WTAGE that represents fish weights as-if
they were observed in the target quarter.}

\item{target_qtr}{Integer 1..4. Target quarter used when \code{standard_quarter = TRUE}.}
}
\value{
A list in the format returned by \code{make_ss_wtage_nage()}:
\itemize{
\item If \code{sex_mode="combined"}: list(WTAGE=..., NAGE=...)
\item If \code{sex_mode="split"}: list(F=list(WTAGE=..., NAGE=...), M=list(WTAGE=..., NAGE=...))
}

A list in the format returned by \code{make_ss_wtage_nage()}:
\itemize{
\item If \code{sex_mode="combined"}: list(WTAGE=..., NAGE=...)
\item If \code{sex_mode="split"}: list(F=list(WTAGE=..., NAGE=...), M=list(WTAGE=..., NAGE=...))
}
}
\description{
Builds Stock Synthesis-style WTAGE and NAGE tables using fishery biology
(age-length-weight) and quarterly blend catch. The workflow is:
\enumerate{
\item Pull fishery biological samples (age, length, weight, sex, gear, area, date).
\item Pull quarterly blend catch and compute within-year quarter proportions (\eqn{p_q}).
\item Build an empirical age-length distribution (length bins by age) from the fishery samples.
\item Fit a length-weight (LW) key and apply it to the empirical age-length distribution to
obtain quarter-specific weight-at-age.
\item Optionally "standardize" to a target quarter by translating lengths to that quarter
using a delta-length (quarter growth) model before applying the LW key.
\item Collapse quarter-specific weight-at-age to annual values using blend catch quarter weights.
\item Convert annual weight-at-age and sample counts into SS WTAGE/NAGE matrices and fill
missing ages safely.
}

Builds Stock Synthesis-style WTAGE and NAGE tables using fishery biology
(age-length-weight) and quarterly blend catch. The workflow is:
\enumerate{
\item Pull fishery biological samples (age, length, weight, sex, gear, area, date).
\item Pull quarterly blend catch and compute within-year quarter proportions (\eqn{p_q}).
\item Build an empirical age-length distribution (length bins by age) from the fishery samples.
\item Fit a length-weight (LW) key and apply it to the empirical age-length distribution to
obtain quarter-specific weight-at-age.
\item Optionally "standardize" to a target quarter by translating lengths to that quarter
using a delta-length (quarter growth) model before applying the LW key.
\item Collapse quarter-specific weight-at-age to annual values using blend catch quarter weights.
\item Convert annual weight-at-age and sample counts into SS WTAGE/NAGE matrices and fill
missing ages safely.
}
}
\details{
The function supports both aggregation choices:
\itemize{
\item Gear: combined across gears, or by gear (Fleet mapping: 1=combined, 2=gear2, 3=gear3).
\item Sex: combined (gender=0) or split (F=1, M=2 in SS convention).
}

The function supports both aggregation choices:
\itemize{
\item Gear: combined across gears, or by gear (Fleet mapping: 1=combined, 2=gear2, 3=gear3).
\item Sex: combined (gender=0) or split (F=1, M=2 in SS convention).
}
}
\seealso{
\code{\link{get_fishery_age_wt_data}}, \code{\link{get_blend_catch}},
\code{\link{build_empirical_length_at_age}}, \code{\link{fit_lw_key}},
\code{\link{fit_quarter_growth_model}}, \code{\link{translate_lengths_to_quarter}},
\code{\link{apply_lw_to_al}}, \code{\link{collapse_catch_weighted_wtaa}},
\code{\link{make_ss_wtage_nage}}

\code{\link{get_fishery_age_wt_data}}, \code{\link{get_blend_catch}},
\code{\link{build_empirical_length_at_age}}, \code{\link{fit_lw_key}},
\code{\link{fit_quarter_growth_model}}, \code{\link{translate_lengths_to_quarter}},
\code{\link{apply_lw_to_al}}, \code{\link{collapse_catch_weighted_wtaa}},
\code{\link{make_ss_wtage_nage}}
}
