% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_neff_from_hauls.R
\name{estimate_neff_from_hauls}
\alias{estimate_neff_from_hauls}
\title{Estimate effective multinomial sample size (Neff) from haul-level compositions}
\usage{
estimate_neff_from_hauls(
  haul_bin_dt,
  bin_col = c("BIN", "LENGTH", "AGE"),
  count_col = "FREQ",
  group_cols = character(0),
  min_hauls = 5L,
  eps = 1e-10,
  cap = 500,
  agg_fun = stats::median
)
}
\arguments{
\item{haul_bin_dt}{A data.frame/data.table with haul-level counts.
Must contain YEAR, HAUL_JOIN, COUNT, and a bin column specified by \code{bin_col}
(e.g., LENGTH or AGE or BIN).}

\item{bin_col}{Name of the bin column in \code{haul_bin_dt}. Common values are
\code{"LENGTH"}, \code{"AGE"}, or \code{"BIN"}. Default \code{"BIN"}.}

\item{group_cols}{Optional character vector of additional grouping columns besides YEAR
(e.g., c("GEAR","SEX","AREA2")).}

\item{min_hauls}{Minimum unique hauls required to estimate Neff (else NA).}

\item{eps}{Small number to avoid division-by-zero in variance.}

\item{cap}{Optional cap for Neff (e.g., 500). Use NULL for no cap.}

\item{agg_fun}{Function to aggregate bin-specific Neff across bins; default median.}
}
\value{
data.table with YEAR (+group_cols), N_HAUL, and NEFF.
}
\description{
Computes an approximate multinomial effective sample size (Neff) using the
between-haul variance in composition proportions. This is useful for deriving
annual (or annual-by-strata) composition sample sizes for Stock Synthesis.
}
\details{
Input data should be haul-level counts by bin (length or age). The function:
\enumerate{
\item Computes within-haul proportions for each bin: \eqn{p_{h,b} = n_{h,b} / \sum_b n_{h,b}}
\item For each YEAR (and optional grouping factors), computes the mean and variance
across hauls for each bin: \eqn{\bar{p}_b, \mathrm{Var}(p_b)}
\item Estimates bin-specific Neff: \eqn{N_{\mathrm{eff},b} = \bar{p}_b(1-\bar{p}_b) / \mathrm{Var}(p_b)}
\item Aggregates across bins (median by default) to get a single Neff per YEAR/group.
}
}
