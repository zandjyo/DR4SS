% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_weight_model.R
\name{fit_weight_model}
\alias{fit_weight_model}
\title{Fit fishery weightâ€“length model with adaptive strata dropping}
\usage{
fit_weight_model(
  fish_data,
  trim_outliers = TRUE,
  trim_q = c(0.01, 0.99),
  min_strata_n = 30,
  allow_gear = TRUE,
  allow_area = TRUE,
  allow_quarter = TRUE,
  allow_sex = TRUE
)
}
\arguments{
\item{fish_data}{data.table returned by \code{get_fishery_age_wt_data()}.}

\item{trim_outliers}{Logical; if TRUE, trim weights using qgam envelopes.}

\item{trim_q}{Length-2 numeric vector of quantiles (default c(0.01, 0.99)).}

\item{min_strata_n}{Minimum number of observations per strata cell
required to retain a factor term.}

\item{allow_gear}{Logical; allow GEAR term.}

\item{allow_area}{Logical; allow AREA term.}

\item{allow_quarter}{Logical; allow QUARTER term.}

\item{allow_sex}{Logical; allow SEX term.}
}
\value{
A list with elements:
\describe{
\item{model}{Fitted \code{mgcv::gam} object}
\item{kept_terms}{Character vector of factor terms retained}
\item{data_used}{data.table of observations used to fit the model}
}
}
\description{
Fits a Gamma(log) GAM for fish weight using length as the primary predictor
and optional stratification terms (YEAR, QUARTER, GEAR, AREA, SEX).
Factor terms are adaptively dropped if any strata cell has fewer than
\code{min_strata_n} observations, in the order:
GEAR -> AREA -> QUARTER -> SEX.

Optional trimming of extreme weights is performed using qgam
quantile envelopes prior to model fitting.
}
