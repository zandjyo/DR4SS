% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/collapse_catch_weighted_wtaa.R
\name{collapse_catch_weighted_wtaa}
\alias{collapse_catch_weighted_wtaa}
\title{Collapse quarter-specific predicted weights-at-age to annual catch-weighted WAA}
\usage{
collapse_catch_weighted_wtaa(
  pred,
  catch_qtr,
  gear_mode = c("combined", "by_gear"),
  sex_mode = c("combined", "split"),
  renormalize = TRUE,
  require_catch_years = TRUE
)
}
\arguments{
\item{pred}{data.table/data.frame from \code{predict_weights_for_aged()} with columns
YEAR, QUARTER, AGE_YRS, WEIGHT_KG, and optionally SEX, GEAR2.}

\item{catch_qtr}{data.table/data.frame from \code{build_catch_qtr_from_blend()} with columns
YEAR, QUARTER, p_q and optionally GEAR2 (if catch weights are gear-specific).}

\item{gear_mode}{Character: "combined" or "by_gear".}

\item{sex_mode}{Character: "combined" or "split".}

\item{renormalize}{Logical. If TRUE (default), renormalize p_q within each
(YEAR, AGE, GEAR2, SEX) over quarters that have non-missing means.}

\item{require_catch_years}{Logical. If TRUE (default), error if any YEAR in \code{pred}
is missing from \code{catch_qtr}. If FALSE, missing years get p_q = 0.}
}
\value{
A data.table with columns:
\describe{
\item{YEAR}{Integer year}
\item{AGE_YRS}{Integer age (plus-grouped already in \code{pred})}
\item{GEAR2}{Integer gear group if gear_mode="by_gear", otherwise absent}
\item{SEX}{"F"/"M" if sex_mode="split", otherwise absent}
\item{WAA}{Catch-weighted annual mean weight-at-age}
\item{N_AGED}{Number of aged observations contributing across all quarters}
\item{P_SUM}{Sum of p_q used in the collapse (after filtering/renormalization)}
}
}
\description{
Computes quarter-specific mean predicted weight-at-age from aged observations and
collapses to an annual mean weight-at-age using quarterly catch proportions from
blend catch. Supports output by gear (GEAR2) and/or sex (SEX) or combined.

Catch-weighted annual mean for a given grouping is:
\deqn{w_{y,a} = \sum_q p_{y,q} \mu_{y,a,q}}
where \eqn{\mu_{y,a,q}} is the mean predicted weight in quarter q and
\eqn{p_{y,q}} is the catch proportion in that quarter (from blend catch).

If some quarters have no observations for a given year-age-group, you can either:
\itemize{
\item renormalize p_q over available quarters (default), or
\item treat missing quarters as contributing nothing (renormalize = FALSE).
}
}
