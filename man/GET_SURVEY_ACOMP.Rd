% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GET_SURVEY_ACOMP.r
\name{GET_SURVEY_ACOMP}
\alias{GET_SURVEY_ACOMP}
\title{Get survey age compositions and format for Stock Synthesis}
\usage{
GET_SURVEY_ACOMP(
  con_akfin = NULL,
  use_vast = FALSE,
  vast_agecomp = NULL,
  species,
  start_yr,
  area = "BS",
  max_age = 12,
  seas = 1,
  flt = 2,
  gender = 1,
  part = 0,
  ageerr = 0,
  lgin_lo = 1,
  lgin_hi = 120
)
}
\arguments{
\item{con_akfin}{A DBI connection to the AKFIN database. Required when
\code{use_vast = FALSE}.}

\item{use_vast}{Logical; if TRUE, use \code{vast_agecomp} instead of querying AKFIN.}

\item{vast_agecomp}{A data.frame/data.table containing VAST age compositions.
Expected columns include \code{Region}, \code{Year}, and age columns (0,1,2,...).
Only used when \code{use_vast = TRUE}.}

\item{species}{Numeric species code.}

\item{start_yr}{Numeric start year (used when querying AKFIN: \code{YEAR >= start_yr}).}

\item{area}{Character; one of \code{"GOA"}, \code{"AI"}, \code{"BS"}, \code{"SLOPE"}.}

\item{max_age}{Integer maximum age (plus group). Ages >= \code{max_age} are pooled.}

\item{seas}{Integer SS season.}

\item{flt}{Integer SS fleet/survey index.}

\item{gender}{Integer SS gender code.}

\item{part}{Integer SS partition code.}

\item{ageerr}{Integer SS age error definition index.}

\item{lgin_lo}{Integer SS Lbin_lo (legacy field in SS agecomp block).}

\item{lgin_hi}{Integer SS Lbin_hi (legacy field in SS agecomp block).}
}
\value{
A data.frame formatted for the Stock Synthesis age-composition data block.
Columns are: YEAR, Seas, FltSvy, Gender, Part, Ageerr, Lgin_lo, Lgin_hi, Nsamp, F0..Fmax_age.
}
\description{
Pulls survey age composition data from the AKFIN database (default) and formats
it into the Stock Synthesis age-composition matrix layout. Optionally, age
compositions can be sourced from a provided VAST age-composition table instead
of querying AKFIN.
}
\details{
This function preserves legacy behavior from historical assessment scripts:
\itemize{
\item Ages greater than or equal to \code{max_age} are pooled into a plus group.
\item For Bering Sea (\code{area = "BS"}), an additional AKFIN query is run for
\code{area_id = 99901}, \code{survey = 98}, and \code{YEAR <= 1986}, and
appended to the main result set.
\item When \code{use_vast = TRUE}, records are filtered to \code{Region == "Both"}
and \code{Year != 2020} to match legacy processing.
}
}
