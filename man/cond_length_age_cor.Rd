% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cond_length_age_cor.r
\name{cond_length_age_cor}
\alias{cond_length_age_cor}
\title{Create conditional age-at-length compositions from survey ages}
\usage{
cond_length_age_cor(
  con_akfin,
  species,
  area,
  start_year,
  max_age,
  len_bins,
  wt = 1,
  seas = 1,
  flt = 2,
  ageerr = 1
)
}
\arguments{
\item{con_akfin}{A DBI connection to the AKFIN database.}

\item{species}{Numeric species code used in the SQL query.}

\item{area}{Character area identifier: one of \code{"GOA"}, \code{"AI"}, \code{"BS"}, \code{"SLOPE"}.}

\item{start_year}{Numeric start year (inclusive) used for the SQL query.}

\item{max_age}{Integer maximum age (plus group). Ages > \code{max_age} are pooled into \code{max_age}.}

\item{len_bins}{Numeric vector of Stock Synthesis length-bin lower edges (in cm).}

\item{wt}{Numeric weighting factor applied to input sample sizes (ISS).}

\item{seas}{Integer SS season value written into the output matrix.}

\item{flt}{Integer SS fleet/survey index written into the output matrix.}

\item{ageerr}{Integer SS age-error definition index written into the output matrix.}
}
\value{
A named list with element \code{norm}, where \code{norm} is a numeric matrix with columns:
\describe{
\item{1}{YEAR}
\item{2}{Seas}
\item{3}{Flt/Svy}
\item{4}{Sex (0 = combined)}
\item{5}{Part (left as 0)}
\item{6}{Ageerr}
\item{7}{Lbin_lo}
\item{8}{Lbin_hi}
\item{9}{Nsamp (optionally reweighted by \code{wt})}
\item{10+}{Conditional age proportions for ages 0:\code{max_age}}
}
}
\description{
Queries specimen-level survey age data (via \code{survey_age.sql}) and builds a
conditional age-at-length composition matrix suitable for the Stock Synthesis
conditional age-at-length (CAAL) format. Ages are pooled into a plus group at
\code{max_age}, and lengths (cm) are assigned to user-supplied Stock Synthesis
length bins (\code{len_bins}).
}
\details{
This function produces a single matrix (returned as \code{output$norm}) with
one row per YEAR x LENGTH_BIN combination. Each row contains the sample size
(optionally reweighted) and the conditional age distribution across ages
0:\code{max_age}.

The SQL template \code{survey_age.sql} must include the placeholder flags:
\itemize{
\item \code{-- insert survey}
\item \code{-- insert start_year}
\item \code{-- insert species}
}
}
