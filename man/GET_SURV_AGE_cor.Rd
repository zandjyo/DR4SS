% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GET_SURV_AGE_cor.r
\name{GET_SURV_AGE_cor}
\alias{GET_SURV_AGE_cor}
\title{Get survey specimen ages and optionally apply an external age-correction model}
\usage{
GET_SURV_AGE_cor(
  con_akfin,
  area = "BS-NBS",
  species = 21720,
  start_yr = 1977,
  max_age = 10,
  extra_csv = NULL,
  extra_reader = utils::read.csv,
  apply_gam_correction = TRUE,
  correction_year_cutoff = 2007
)
}
\arguments{
\item{con_akfin}{A DBI connection to the AKFIN database.}

\item{area}{Character area identifier: one of \code{"GOA"}, \code{"BS"},
\code{"AI"}, \code{"SLOPE"}.}

\item{species}{Numeric species code (single value or vector).}

\item{start_yr}{Numeric start year (inclusive) for the AKFIN query.}

\item{max_age}{Integer maximum age; ages \code{>= max_age} are pooled into \code{max_age}.}

\item{extra_csv}{Optional path to a CSV file used for external age-correction.
If \code{NULL}, no correction is applied.}

\item{extra_reader}{Function used to read \code{extra_csv}. Defaults to
\code{utils::read.csv}.}

\item{apply_gam_correction}{Logical; if TRUE and \code{extra_csv} is provided,
attempts the legacy GAM correction. If required columns are missing, a warning
is issued and correction is skipped.}

\item{correction_year_cutoff}{Numeric; if GAM correction is applied, years
\code{< correction_year_cutoff} are assigned GAM-predicted ages (legacy default 2007).}
}
\value{
A data.table of specimen records with an added \code{AGE1} column.
}
\description{
Queries specimen-level survey age data from AKFIN (via the SQL template
\code{survey_age.sql}) and returns a table of specimen records. Adds \code{AGE1},
which pools all ages \code{>= max_age} into a plus group.
}
\details{
Optionally, an external CSV can be provided (via \code{extra_csv}) to fit a
correction model (legacy GAM-based approach) and overwrite \code{AGE1} for
a subset of years. This replaces the previous hard-coded dependency on
\code{"Steves pcod4.csv"} while keeping the ability to use external data.
}
